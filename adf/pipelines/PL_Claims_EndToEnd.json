{
  "name": "PL_Claims_EndToEnd",
  "properties": {
    "description": "Copy raw claims files -> ADLS raw, then run Databricks notebooks for Bronze/Silver/Gold.",
    "activities": [
      {
        "name": "CopyClaimsToRaw",
        "type": "Copy",
        "dependsOn": [],
        "policy": {
          "timeout": "7.00:00:00",
          "retry": 2,
          "retryIntervalInSeconds": 30,
          "secureOutput": false,
          "secureInput": false
        },
        "typeProperties": {
          "source": {
            "type": "DelimitedTextSource"
          },
          "sink": {
            "type": "DelimitedTextSink"
          },
          "enableStaging": false
        },
        "inputs": [
          {
            "referenceName": "DS_FileServer_Claims",
            "type": "DatasetReference"
          }
        ],
        "outputs": [
          {
            "referenceName": "DS_ADLS_Raw_Claims",
            "type": "DatasetReference"
          }
        ]
      },
      {
        "name": "RunBronzeNotebook",
        "type": "DatabricksNotebook",
        "dependsOn": [
          {
            "activity": "CopyClaimsToRaw",
            "dependencyConditions": [
              "Succeeded"
            ]
          }
        ],
        "typeProperties": {
          "notebookPath": "/Shared/claims/01_bronze_ingest",
          "baseParameters": {
            "raw_input_path": "abfss://raw@styagidatalake.dfs.core.windows.net/claims/",
            "bronze_output_path": "abfss://bronze@styagidatalake.dfs.core.windows.net/claims_delta/",
            "ingest_date": "@{formatDateTime(utcnow(),'yyyy-MM-dd')}"
          }
        },
        "linkedServiceName": {
          "referenceName": "LS_AzureDatabricks",
          "type": "LinkedServiceReference"
        }
      },
      {
        "name": "RunSilverNotebook",
        "type": "DatabricksNotebook",
        "dependsOn": [
          {
            "activity": "RunBronzeNotebook",
            "dependencyConditions": [
              "Succeeded"
            ]
          }
        ],
        "typeProperties": {
          "notebookPath": "/Shared/claims/02_silver_transform",
          "baseParameters": {
            "bronze_input_path": "abfss://bronze@styagidatalake.dfs.core.windows.net/claims_delta/",
            "silver_output_path": "abfss://silver@styagidatalake.dfs.core.windows.net/claims_silver/",
            "process_from_date": "2022-01-01"
          }
        },
        "linkedServiceName": {
          "referenceName": "LS_AzureDatabricks",
          "type": "LinkedServiceReference"
        }
      },
      {
        "name": "RunGoldNotebook",
        "type": "DatabricksNotebook",
        "dependsOn": [
          {
            "activity": "RunSilverNotebook",
            "dependencyConditions": [
              "Succeeded"
            ]
          }
        ],
        "typeProperties": {
          "notebookPath": "/Shared/claims/03_gold_marts",
          "baseParameters": {
            "silver_input_path": "abfss://silver@styagidatalake.dfs.core.windows.net/claims_silver/",
            "gold_output_path": "abfss://gold@styagidatalake.dfs.core.windows.net/marts/"
          }
        },
        "linkedServiceName": {
          "referenceName": "LS_AzureDatabricks",
          "type": "LinkedServiceReference"
        }
      }
    ],
    "annotations": [
      "claims",
      "medallion",
      "azure",
      "databricks"
    ],
    "folder": {
      "name": "claims_etl"
    }
  }
}